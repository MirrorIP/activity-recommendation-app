var SpacesSDK=(function(){var y="1.3.0";var f=(function(){var H=function(N){function O(R){var Q=String(R);if(Q.length===1){Q="0"+Q;}return Q;}var M=N.getFullYear()+"-"+O(N.getMonth()+1)+"-"+O(N.getDate());M+="T"+O(N.getHours())+":"+O(N.getMinutes())+":"+O(N.getSeconds())+"."+String((N.getMilliseconds()/1000).toFixed(3)).slice(2,5);var P=-N.getTimezoneOffset();M+=(P>=0?"+":"-")+O(Math.floor(P/60))+":"+O(P%60);return M;};var K=function(P){var R=/^(\d{4}\-\d\d\-\d\d([tT][\d:\.]*)?)([zZ]|([+\-])(\d\d):(\d\d))?$/;var Q=R.exec(P)||[];if(Q[1]){var M=Q[1].split(/\D/);for(var O=0;O<M.length;O++){M[O]=parseInt(M[O],10)||0;}M[1]-=1;if(Q[5]){var S=(parseInt(Q[5],10)*60);if(Q[6]){S+=parseInt(Q[6],10);}if(Q[4]=="+"){S*=-1;}if(S){M[4]+=S;}}var N=new Date(Date.UTC(M[0],M[1],M[2],M[3],M[4],M[5]));if(M[6]){N.setMilliseconds(M[6]);}return N;}else{return NaN;}};var L=function(M){return M.replace(/^\s+|\s+$/g,"");};var D=function(N){var M;if(window.DOMParser){var O=new DOMParser();M=O.parseFromString(N,"text/xml");}else{M=new ActiveXObject("MSXML.DOMDocument");M.async=false;M.loadXML(N);}return M;};var J=function(N,O){if(!N){throw {name:"IllegalArgumentException",message:"A element name is required."};}var P=null;if(typeof(ActiveXObject)!="undefined"){P=new ActiveXObject("MSXML.DOMDocument");var M=(O)?P.createNode(1,N,O):P.createElement(N);P.appendChild(M);}else{if(document.implementation.createDocument){P=document.implementation.createDocument(O,N,null);}else{throw {name:"NotSupportedException",message:"The browser does not support the required XML operations."};}}return P;};var G=function(M){if(!M||(typeof M)!="object"){throw {name:"IllegalArgumentException",message:"A element name is required."};}var N=E.generateXMLString(M);return E.generateXMLDocumentFromString(N);};var F=function(M){return Strophe.serialize(M);};var I=function(P,Q){var O;var M=null;var R={};for(O=0;O<P.attributes.length;O++){R[P.attributes.item(O).name]=P.attributes.item(O).value;}if(P.namespaceURI){R.xmlns=P.namespaceURI;}M=$build(P.nodeName,R);for(O=0;O<P.childNodes.length;O++){var N=P.childNodes[O];if(N.nodeType==3){M.t(N.nodeValue);}else{if(N.nodeType==4){M.cnode(N);M.up();}else{E.elementToStopheTree(N,M);}}}if(Q){Q.cnode(M.tree());Q.up();}return M;};var E={getDateForISO8601:K,getISO8601ForDate:H,trimString:L,generateXMLDocumentFromString:D,createXMLDocument:J,createXMLDocumentWithElement:G,generateXMLString:F,elementToStopheTree:I,};return E;})();var n={OFFLINE:"OFFLINE",ONLINE:"ONLINE",ERROR:"ERROR",PENDING:"PENDING"};var i={MEMBER:"MEMBER",MODERATOR:"MODERATOR"};var o={PRIVATE:"PRIVATE",TEAM:"TEAM",ORGA:"ORGA",getTypeForString:function(E){for(var D in SpacesSDK.Type){if(typeof SpacesSDK.Type[D]==="string"){if(SpacesSDK.Type[D].toLowerCase()===E.toLowerCase()){return D;}}}return null;}};var s={ON:"ON",OFF:"OFF",DURATION:"DURATION"};var j=function(D){return{name:"SpaceManagementException",message:D};};var r=function(D){return{name:"UnknownEntityException",message:D};};var q=(function(){var E={CDM_0_1:"0.1",CDM_0_2:"0.2",CDM_1_0:"1.0",CDM_2_0:"2.0",getVersionForString:function(I){for(var H in SpacesSDK.cdm.CDMVersion){if(typeof SpacesSDK.cdm.CDMVersion[H]==="string"){if(SpacesSDK.cdm.CDMVersion[H]===I){return H;}}}return null;}};var D=function(M,J){var K=function(){return M;};var L=function(){return J?J:SpacesSDK.cdm.Reference.ReferenceType.DEPENDENCY;};var H=function(N){var O=N.ownerDocument;var P=O.createElement("reference");P.setAttribute("id",M);if(SpacesSDK.cdm.Reference.ReferenceType.WEAK==J){P.setAttribute("type",SpacesSDK.cdm.Reference.ReferenceType.WEAK);}N.appendChild(P);};var I={getId:K,getReferenceType:L,addToElement:H};return I;};D.ReferenceType={DEPENDENCY:"dependency",WEAK:"weak",getReferenceTypeForString:function(I){for(var H in SpacesSDK.cdm.Reference.ReferenceType){if(typeof SpacesSDK.cdm.Reference.ReferenceType[H]==="string"){if(SpacesSDK.cdm.Reference.ReferenceType[H]===I){return H;}}}return null;}};var G=function(J,N,L){var M=function(){return L;};var O=function(){return N;};var I=function(){return J;};var H=function(Q){var U=Q.ownerDocument;var T=U.createElement("creationInfo");if(J){var S=U.createElement("date");S.textContent=J;T.appendChild(S);}if(N){var R=U.createElement("person");R.textContent=N;T.appendChild(R);}if(L){var P=U.createElement("application");P.textContent=L;T.appendChild(P);}Q.appendChild(T);};var K={getApplication:M,getCreator:O,getCreationDate:I,addToElement:H};return K;};var F={CDMVersion:E,Reference:D,CreationInfo:G};return F;})();var a=function(E){var M=E.ownerDocument;var G={};var K={};(function(){if(!E){throw {name:"IllegalArgumentException",message:"XML document containing the CDM data is required."};}K.cdmVersion=E.getAttribute("cdmVersion")?E.getAttribute("cdmVersion"):SpacesSDK.cdm.CDMVersion.CDM_2_0;K.id=E.getAttribute("id");K.timestamp=E.getAttribute("timestamp");switch(K.cdmVersion){case SpacesSDK.cdm.CDMVersion.CDM_0_1:F(E);break;case SpacesSDK.cdm.CDMVersion.CDM_0_2:D(E);break;case SpacesSDK.cdm.CDMVersion.CDM_1_0:J(E);break;case SpacesSDK.cdm.CDMVersion.CDM_2_0:L(E);break;}})();function I(P){P.setAttribute("cdmVersion",K.cdmVersion);if(K.id){P.setAttribute("id",K.id);}if(K.timestamp){P.setAttribute("timestamp",K.timestamp);}}function F(Q){K.creator=Q.getAttribute("creator");var R=function(){return K.creator;};var P=function(S){I(S);if(K.creator){S.setAttribute("creator",K.creator);}};G.getCreator=R;G.applyToElement=P;}function D(Q){K.creator=Q.getAttribute("creator");K.ref=Q.getAttribute("ref");var S=function(){return K.creator;};var R=function(){return K.ref;};var P=function(T){I(T);if(K.creator){T.setAttribute("creator",K.creator);}if(K.ref){T.setAttribute("ref",K.ref);}};G.getCreator=S;G.getRef=R;G.applyToElement=P;}function J(Q){K.customId=Q.getAttribute("customId");K.modelVersion=Q.getAttribute("modelVersion");K.publisher=Q.getAttribute("publisher");K.ref=Q.getAttribute("ref");var T=function(){return K.customId;};var U=function(){return K.modelVersion;};var R=function(){return K.publisher;};var S=function(){return K.ref;};var P=function(V){I(V);if(K.customId){V.setAttribute("customId",K.customId);}if(K.modelVersion){V.setAttribute("modelVersion",K.modelVersion);}if(K.ref){V.setAttribute("ref",K.ref);}if(K.publisher){V.setAttribute("publisher",K.publisher);}};G.getCustomId=T;G.getModelVersion=U;G.getPublisher=R;G.getRef=S;G.applyToElement=P;}function L(W){K.customId=W.getAttribute("customId");K.modelVersion=W.getAttribute("modelVersion");K.publisher=W.getAttribute("publisher");K.ref=W.getAttribute("ref");K.copyOf=W.getAttribute("copyOf");K.updates=W.getAttribute("updates");for(var ai=0;ai<W.childNodes.length;ai++){var U=W.childNodes[ai];if(U.nodeType==1){switch(U.nodeName){case"summary":K.summary=U.textContent;break;case"references":K.references=[];for(var ag=0;ag<U.childNodes.length;ag++){var ae=U.childNodes[ag];if(ae.nodeName=="reference"){var V=ae.getAttribute("id");var S=SpacesSDK.cdm.Reference.ReferenceType.getReferenceTypeForString(ae.getAttribute("type"));K.references.push(new SpacesSDK.cdm.Reference(V,S));}}break;case"creationInfo":var T=null;var Z=null;var Y=null;for(var ag=0;ag<U.childNodes.length;ag++){var aa=U.childNodes[ag];switch(aa.nodeName){case"date":T=aa.textContent;break;case"person":Z=aa.textContent;break;case"application":Y=aa.textContent;break;}}K.creationInfo=SpacesSDK.cdm.CreationInfo(T,Z,Y);break;}}}var R=function(){return K.customId;};var ad=function(){return K.modelVersion;};var al=function(){return K.publisher;};var ah=function(){return K.ref;};var aj=function(){return K.copyOf;};var af=function(){return K.copyOf?true:false;};var ac=function(){return K.summary;};var Q=function(){return K.updates;};var ak=function(){return K.updates?true:false;};var X=function(){return K.references;};var P=function(){return K.creationInfo;};var ab=function(am){I(am);var ap=["customId","modelVersion","ref","publisher","copyOf","updates"];for(var an=0;an<ap.length;an++){if(K[ap[an]]){am.setAttribute(ap[an],K[ap[an]]);}}var aq=am.ownerDocument;if(K.summary){var ao=aq.createElement("summary");ao.textContent=K.summary;am.appendChild(ao);}if(K.references){var ar=aq.createElement("references");for(var an=0;an<K.references.length;an++){K.references[an].addToElement(ar);}am.appendChild(ar);}if(K.creationInfo){K.creationInfo.addToElement(am);}};G.getCustomId=R;G.getModelVersion=ad;G.getPublisher=al;G.getRef=ah;G.getCopyOf=aj;G.getSummary=ac;G.getReferences=X;G.getCreationInfo=P;G.applyToElement=ab;}var N=function(){return K.cdmVersion;};var H=function(){return K.id;};var O=function(){return(K.timestamp)?f.getDateForISO8601(K.timestamp):null;};G.getCDMVersion=N;G.getId=H;G.getTimeStamp=O;return G;};var x=function(N){var L={};(function(){L.cdmVersion=N?N:SpacesSDK.cdm.CDMVersion.CDM_2_0;})();var Q=function(){var Y=f.createXMLDocument("root");var T=Y.childNodes[0];var W=["cdmVersion","customId","creator","customId","id","timestamp","modelVersion","publisher","ref","copyOf","updates"];for(var U=0;U<W.length;U++){if(L[W[U]]){T.setAttribute(W[U],L[W[U]]);}}if(L.summary){var V=Y.createElement("summary");V.textContent=L.summary;T.appendChild(V);}if(L.references){var X=Y.createElement("references");for(var U=0;U<L.references.length;U++){L.references[U].addToElement(X);}T.appendChild(X);}if(L.creationInfo){L.creationInfo.addToElement(T);}return new a(T);};var R=function(T){L.creator=T;return D;};var I=function(T){L.customId=T;return D;};var E=function(T){L.id=T;return D;};var S=function(T){L.modelVersion=T;return D;};var J=function(T){L.publisher=T;return D;};var K=function(T){L.ref=T;return D;};var M=function(T){L.timestamp=T;return D;};var O=function(T){L.copyOf=T;return D;};var P=function(T){L.updates=T;return D;};var H=function(T){L.summary=T;return D;};var G=function(T){if(L.references==null){L.references=[];}L.references.push(T);return D;};var F=function(T){L.creationInfo=T;return D;};var D={build:Q,setCreator:R,setCustomId:I,setId:E,setModelVersion:S,setPublisher:J,setRef:K,setTimestamp:M,setCopyOf:O,setUpdates:P,setSummary:H,addReference:G,setCreationInfo:F};return D;};var w=function(J,Q,H,L,K,N,M){var G=function(){return K;};var P=function(){return J;};var O=function(){return Q;};var F=function(){return H;};var N=function(){return N;};var I=function(){return M;};var E=function(){return L?L:2000;};var D={getApplicationID:G,getDomain:P,getHost:O,getPort:F,isSecureConnection:N,isSelfSignedCertificateEnabled:I,requestTimeout:E};return D;};var b=function(U,E){var J=null;var H=null;var M=null;var I=null;var L=null;var F=null;var T=null;(function(){J=5222;H=true;M=true;I=U;L=E;T=2000;})();var O=function(){if(L==null||f.trimString(L).length==0){throw {name:"IllegalStateException",message:"The application identifier is not initialized or empty, but has to be set."};}var V=(I!=null)&&(f.trimString(I).length!=0);var W=(F!=null)&&(f.trimString(F).length!=0);if(!V&&!W){throw {name:"IllegalStateException",message:"Either hostname or domain has to be set."};}if(!V&&W){I=F;}else{if(!W&&V){F=I;}}return new w(I,F,J,T,L,H,M);};var N=function(V){L=V;return K;};var Q=function(V){I=V;return K;};var R=function(V){F=V;return K;};var P=function(V){J=V;return K;};var G=function(V){H=V;return K;};var S=function(V){M=V;return K;};var D=function(V){T=V;return K;};var K={build:O,setApplicationId:N,setDomain:Q,setHost:R,setPort:P,setSecureConnection:G,setSelfSignedCertificateEnabled:S,setTimeout:D};return K;};var z=function(G,I,H){var F=function(){return G;};var E=function(){return I;};var J=function(){return H;};var D={getSpacesServiceJID:F,getSpacesServiceVersion:E,getPersistenceServiceJID:J};return D;};var g=function(Y,E,Q,X){var R=null;var S=null;var K=null;var N=null;var F=null;(function(){K=new k(Y.toLowerCase(),Q.getDomain(),Q.getApplicationID());N=new Strophe.Connection(X);R={};Strophe.log=function(aa,Z){if(aa===2){console.log("WARN: ",Z);}else{if(aa>=3){console.log("ERROR: ",Z);}}};O(SpacesSDK.ConnectionStatus.OFFLINE);})();function O(Z){S=Z;for(var aa in R){var ab=R[aa];ab.connectionStatusChanged(S);}}var D=function(ag){var ac=null;var ae=null;var ad=null;var ab={xmlns:Strophe.NS.DISCO_ITEMS};var af=$iq({from:K.getFullJID(),to:Q.getDomain(),type:"get"}).c("query",ab);var aa=function(am){if(!ag){return;}var aj=$(am);var ah=aj.find("item");for(var al=0;al<ah.length;al++){var ak=ah[al];if("MIRROR Spaces Service".toLowerCase()==ak.getAttribute("name").toLowerCase()){ac=ak.getAttribute("jid");}else{if("MIRROR Persistence Service".toLowerCase()==ak.getAttribute("name").toLowerCase()){ae=ak.getAttribute("jid");}}}if(ac){var ai=$iq({from:K.getFullJID(),to:ac,type:"get"}).c("spaces",{xmlns:Strophe.NS.SPACES}).c("version");N.sendIQ(ai,function(an){ad=an.getElementsByTagName("version")[0].textContent;ag(new z(ac,ad,ae));},function(ao){if(ao){var an=ao.getElementsByTagName("error")[0];console.warn("Failed to retrieve spaces service version: "+f.generateXMLString(an));}else{console.warn("Failed to retrieve spaces service version.");}ag(new z(ac,null,ae));},Q.requestTimeout());}else{ag(new z(null,null,ae));}};var Z=function(ai){if(ai){var ah=$(ai).find("error");console.warn("Failed to retrieve network information: "+ah[0].getAttribute("code"),ah[0]);}else{console.log("Failed to retrieve network information.");}ag();};N.sendIQ(af,aa,Z,Q.requestTimeout());};var U=function(Z){R[Z.name]=Z;};var G=function(){O(SpacesSDK.ConnectionStatus.PENDING);N.connect(K.getFullJID(),E,function Z(ab,aa){if(ab==Strophe.Status.CONNECTED){N.send($pres());D(function(ac){F=ac;O(SpacesSDK.ConnectionStatus.ONLINE);});}else{if(ab==Strophe.Status.ERROR||ab==Strophe.Status.CONNFAIL||ab==Strophe.Status.AUTHFAIL){O(SpacesSDK.ConnectionStatus.ERROR);}else{if(ab==Strophe.Status.AUTHENTICATING||ab==Strophe.Status.DISCONNECTING||ab==Strophe.Status.CONNECTING){O(SpacesSDK.ConnectionStatus.PENDING);}else{if(ab==Strophe.Status.DISCONNECTED){O(SpacesSDK.ConnectionStatus.OFFLINE);}}}}});};var H=function(){N.register.connect(Q.getHost(),function Z(aa){if(aa==Strophe.Status.REGISTER){N.register.fields.username=K.getUsername().toLowerCase();N.register.fields.password=E;N.register.submit();}else{if(aa==Strophe.Status.REGISTERED){N.authenticate();}else{if(aa==Strophe.Status.CONNECTED){N.send($pres());D(function(ab){F=ab;O(SpacesSDK.ConnectionStatus.ONLINE);});}else{if(aa==Strophe.Status.ERROR||aa==Strophe.Status.CONNFAIL||aa==Strophe.Status.AUTHFAIL||aa==Strophe.Status.SBMTFAIL||aa==Strophe.Status.REGIFAIL){O(SpacesSDK.ConnectionStatus.ERROR);}else{if(aa==Strophe.Status.AUTHENTICATING||aa==Strophe.Status.DISCONNECTING||aa==Strophe.Status.CONNECTING||aa==Strophe.Status.REGISTERING||aa==Strophe.Status.SUBMITTING){O(SpacesSDK.ConnectionStatus.PENDING);}else{if(aa==Strophe.Status.DISCONNECTED){O(SpacesSDK.ConnectionStatus.OFFLINE);}}}}}}});};var W=function(){if(S==SpacesSDK.ConnectionStatus.OFFLINE){return;}O(SpacesSDK.ConnectionStatus.PENDING);N.disconnect();O(SpacesSDK.ConnectionStatus.OFFLINE);};var L=function(){return Q;};var I=function(){return K;};var J=function(){return F;};var P=function(){return S;};var V=function(){return N;};var T=function(aa){var Z=[];for(var ab in R){if(aa.name===ab){continue;}Z[ab]=R[ab];}R=Z;};var M={addConnectionStatusListener:U,connect:G,connectAndCreateUser:H,disconnect:W,getConfiguration:L,getCurrentUser:I,getNetworkInformation:J,getStatus:P,getXMPPConnection:V,removeConnectionStatusListener:T};return M;};var v=function(F,E){var D=new Object();D.name=F;D.connectionStatusChanged=E;return D;};var C=function(I,X){var Y=null;var S=null;var E=null;var V=null;var L=null;var N=null;var Q=null;(function(){Y=new Object();S=new Object();V=I.getXMPPConnection();L=I.getCurrentUser();N=new Object();Q=I.getConfiguration().requestTimeout();V.addHandler(J,null,"message",null,null,null);})();function ad(al){for(var am in S){var ak=S[am];var aj=ak.getPubSubChannel().getProperties();if(aj.node===al){return am;}}return null;}function Z(ap,aj){if(!N[ap]){N[ap]=[];}for(var al=0;al<aj.length;al++){var am=aj[al];if(!am.getId){continue;}var ao=false;for(var ak=0;ak<N[ap].length;ak++){var an=N[ap][ak];if(!an.getId&&(am.getId()==an.getId())){ao=true;break;}}if(!ao){N[ap].push(am);}}}function aa(at){var ap=[];var au=[];var aj=at.getElementsByTagName("items")[0];if(aj&&aj!=null){var ak=aj.attributes.getNamedItem("node");if(ak&&ak.value){aj=ak.value;}else{if(ak&&ak.nodeValue){aj=ak.nodeValue;}else{return null;}}var aq=ad(aj);if(aq==null||!S[aq]){return;}var ao=at.getElementsByTagName("item");for(var am=0;am<ao.length;am++){if(ao[am].firstChild==null){if(ao[am].attributes.getNamedItem("id").value){ap[ap.length]=ao[am].attributes.getNamedItem("id").value;}else{ap[ap.length]=ao[am].attributes.getNamedItem("id").nodeValue;}}else{var ar=ao[am].firstChild;var an=f.createXMLDocumentWithElement(ar);var al=new u(an.childNodes[0]);if(!E||E.isDataObjectValid(al)){Z(aq,[al]);}au[au.length]=al;}}if(ap.length>0){H(aj,ap);}return au;}}function J(ar){var aj=ar.getElementsByTagName("items")[0];if(aj&&aj!=null){var al=aj.attributes.getNamedItem("node");if(al&&al.value){aj=al.value;}else{if(al&&al.nodeValue){aj=al.nodeValue;}else{return true;}}if(!aj||aj==null){return true;}var ap=ad(aj);if(!ap||ap==null){return true;}var aq=aa(ar);if(!aq||aq==null){return true;}for(var ao in Y){var ak=Y[ao];for(var an=0;an<aq.length;an++){var am=aq[an];if(!E||E.isDataObjectValid(am)){ak.handleDataObject(am,ap);}}}}return true;}function H(an,aj){for(var ak=0;ak<aj.length;ak++){var al=aj[ak];var am=$iq({from:this.jid,to:this.service,type:"get"}).c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("items",{node:an}).c("item",{id:al});V.sendIQ(am.tree(),function(){},function(){},Q);}}var R=function(aj){Y[aj.name]=aj;};var P=function(){var aj=new Object();for(var ak in S){aj[ak]=S[ak];}return aj;};var af=function(aj,am,al,ak){if(!al){al=function(){};}if(!ak){ak=function(an){console.warn("Failed to publish data object:",an);};}X.getSpace(am,function(aq){if(aq==null){ak("A space with the given ID could not be retrieved.");return;}var ar=aq.getPubSubChannel().getProperties().node;var ao=aj.getElement();var ap=f.elementToStopheTree(ao);var an=new Array();an[0]=new Object();an[0].attrs={};an[0].data=ap.tree();V.pubsub.publish(ar,an,function(at){switch(at.getAttribute("type")){case"result":al();break;default:ak(at);break;}});},function(an){ak(an);});};var ab=function(ak,aj){if(S[ak]){return;}if(!aj){aj=function(al){console.warn("An error occured while the space was registered.",al);};}X.getSpace(ak,function(al){S[al.getId()]=al;N[al.getId()]=[];},function(al){aj(al);});};var ac=function(ak){var aj=new Object();for(var al in Y){if(ak.name===al){continue;}aj[al]=Y[al];}Y=aj;};var ag=function(al){if(!S[al]){return;}else{var ak=[];for(var aj in S){if(aj===al){continue;}ak[aj]=S[aj];}S=ak;delete N[al];}};var D=function(aj){return N[aj]?N[aj]:[];};var K=function(aj){E=aj;};var F=function(){return E;};function M(al,am,ak){var aj=[];V.sendIQ(al,function(ar){var ao=ar.getElementsByTagName("result")[0];for(var an=0;an<ao.children.length;an++){var aq=ao.children[an];var ap=new u(aq);aj.push(ap);}am(aj);},function(ao){if(ao){var an=ao.getElementsByTagName("error")[0];ak("Peristence service query failed: "+f.generateXMLString(an));}else{ak("Persistence service query failed.");}},I.getConfiguration().requestTimeout());}var U=function(aj,an,am){if(!am){am=function(ao){console.warn("[ERROR] "+ao);};}if(I.getStatus()!=n.ONLINE){am("You must be online in order to query data.");return;}var al=I.getNetworkInformation().getPersistenceServiceJID();if(!al){am("No persistence service available.");}var ak=$iq({from:I.getCurrentUser().getFullJID(),to:al,type:"get"}).c("query",{xmlns:"urn:xmpp:spaces:persistence"});ak.c("object",{id:aj});M(ak,function(ao){an(ao.length>0?ao[0]:null);},am);};var G=function(am,al,ap,ao){if(!ao){ao=function(au){console.warn("[ERROR] "+au);};}if(I.getStatus()!=n.ONLINE){ao("You must be online in order to query data.");return;}var aj=I.getNetworkInformation().getPersistenceServiceJID();if(!aj){ao("No persistence service available.");}var at=[];if(0==am.length){ap(at);return;}var aq=$iq({from:I.getCurrentUser().getFullJID(),to:aj,type:"get"}).c("query",{xmlns:"urn:xmpp:spaces:persistence"});aq.c("objects");for(var an=0;an<am.length;an++){aq.c("object",{id:am[an]}).up();}if(al&&al.length>0){aq.up().c("filters");for(var an=0;an<al.length;an++){var ak=al[an];if(ak.getFilterAsXML){var ar=ak.getFilterAsXML("urn:xmpp:spaces:persistence");f.elementToStopheTree(ar,aq);}}}M(aq,ap,ao);};function O(an,al,am,ak){var aj=[];X.getSpace(an,function(ao){if(ao.getPersistenceType()==s.ON){V.pubsub.items(ao.getPubSubChannel().getProperties().node,function(aA){var ax=[];var aB=[];var ap=aA.getElementsByTagName("items")[0];if(ap){var aq=ap.attributes.getNamedItem("node");if(aq&&aq.value){ap=aq.value;}else{if(aq&&aq.nodeValue){ap=aq.nodeValue;}else{ak("Failed to retrieve items from pubsub node.");}}var aw=aA.getElementsByTagName("item");for(var au=0;au<aw.length;au++){if(aw[au].firstChild==null){if(aw[au].attributes.getNamedItem("id").value){ax[ax.length]=aw[au].attributes.getNamedItem("id").value;}else{ax[ax.length]=aw[au].attributes.getNamedItem("id").nodeValue;}}else{var az=aw[au].firstChild;var av=f.createXMLDocumentWithElement(az);var ar=new u(av.firstChild);var ay=true;for(var at=0;at<al.length;at++){ay&=al[at].isDataObjectValid(ar);}if(ay){aj.push(ar);}}}Z(an,aj);am(aj);}else{am(aj);}},function(ap){ak("Failed to retrieve data objects from pubsub node.",ap);},Q);}else{am(aj);}},function(ao){ak("Failed to retrieve space information. ",ao);});}var ai=function(aq,al,ao,an){if(!an){an=function(au){console.warn("[ERROR] "+au);};}if(I.getStatus()!=n.ONLINE){an("You must be online in order to query data.");return;}var aj=I.getNetworkInformation().getPersistenceServiceJID();if(!aj){O(aq,al,ao,an);return;}var at=[];var ap=$iq({from:I.getCurrentUser().getFullJID(),to:aj,type:"get"}).c("query",{xmlns:"urn:xmpp:spaces:persistence"});ap.c("objectsForSpace",{id:aq});if(al&&al.length>0){ap.up().c("filters");for(var am=0;am<al.length;am++){var ak=al[am];if(ak.getFilterAsXML){var ar=ak.getFilterAsXML("urn:xmpp:spaces:persistence");f.elementToStopheTree(ar,ap);}}}M(ap,function(au){Z(aq,au);ao(au);},an);};var ae=function(ar,al,ap,ao){if(!ao){ao=function(av){console.warn("[ERROR] "+av);};}if(I.getStatus()!=n.ONLINE){ao("You must be online in order to query data.");return;}var au=[];if(ar.length==0){ap(au);return;}var aj=I.getNetworkInformation().getPersistenceServiceJID();if(!aj){var am=0;for(var an=0;an<ar.length;an++){O(ar[an],al,function(av){au=au.concat(av);am+=1;if(am==ar.length){ap(au);}},function(av){ao(av);});}return;}var aq=$iq({from:I.getCurrentUser().getFullJID(),to:aj,type:"get"}).c("query",{xmlns:"urn:xmpp:spaces:persistence"});aq.c("objectsForSpaces");for(var an=0;an<ar.length;an++){aq.c("space",{id:ar[an]}).up();}if(al&&al.length>0){aq.up().c("filters");for(var an=0;an<al.length;an++){var ak=al[an];if(ak.getFilterAsXML){var at=ak.getFilterAsXML("urn:xmpp:spaces:persistence");f.elementToStopheTree(at,aq);}}}M(aq,ap,ao);};var W=function(aj,an,am){if(!am){am=function(ao){console.warn("[ERROR] "+ao);};}if(I.getStatus()!=n.ONLINE){am("You must be online in order to perform the query.");return;}var al=I.getNetworkInformation().getPersistenceServiceJID();if(!al){am("No persistence service available.");return;}var ak=$iq({from:I.getCurrentUser().getFullJID(),to:al,type:"set"}).c("delete",{xmlns:"urn:xmpp:spaces:persistence"});ak.c("object",{id:aj});V.sendIQ(ak,function(ap){var ao=ap.getElementsByTagName("delete")[0];var aq=ao.getAttribute("objectsDeleted");an(parseInt(aq)>0);},function(ap){if(ap){var ao=ap.getElementsByTagName("error")[0];am("Peristence service query failed: "+f.generateXMLString(ao));}else{am("Persistence service query failed.");}},I.getConfiguration().requestTimeout());};var ah=function(ak,ao,an){if(!an){an=function(ap){console.warn("[ERROR] "+ap);};}if(ak.length==0){ao(0);return;}if(I.getStatus()!=n.ONLINE){an("You must be online in order to perform the query.");return;}var am=I.getNetworkInformation().getPersistenceServiceJID();if(!am){an("No persistence service available.");return;}var al=$iq({from:I.getCurrentUser().getFullJID(),to:am,type:"set"}).c("delete",{xmlns:"urn:xmpp:spaces:persistence"});al.c("objects");for(var aj=0;aj<ak.length;aj++){al.c("object",{id:ak[aj]}).up();}V.sendIQ(al,function(aq){var ap=aq.getElementsByTagName("delete")[0];var ar=ap.getAttribute("objectsDeleted");ao(parseInt(ar));},function(aq){if(aq){var ap=aq.getElementsByTagName("error")[0];an("Peristence service query failed: "+f.generateXMLString(ap));}else{an("Persistence service query failed.");}},I.getConfiguration().requestTimeout());};var T={addDataObjectListener:R,getHandledSpaces:P,publishDataObject:af,registerSpace:ab,removeDataObjectListener:ac,removeSpace:ag,retrieveDataObjects:D,setDataObjectFilter:K,getDataObjectFilter:F,queryDataObjectById:U,queryDataObjectsById:G,queryDataObjectsBySpace:ai,queryDataObjectsBySpaces:ae,deleteDataObject:W,deleteDataObjects:ah};return T;};var B=function(H,G){var F=function(){return H;};var D=function(){return G;};var I=function(J){if(J==null){return false;}if(J.getNamespace==null||typeof J.getNamespace!=="function"){return false;}else{if(J.getSchemaLocation==null||typeof J.getSchemaLocation!=="function"){return false;}else{if(J.getSchemaLocation()===G&&J.getNamespace()===H){return true;}}}return false;};var E={getNamespace:F,getSchemaLocation:D,equals:I};return E;};var p=(function(){var F=function(){var N=[];var M=function(P){if(!P.isDataObjectValid){throw"Invalid data object filter.";return;}N.push(P);};var O=function(){return N;};var K=function(Q){for(var P=0;P<N.length;P++){if(!N[P].isDataObjectValid(Q)){return false;}}return true;};var L={addFilter:M,getFilters:O,isDataObjectValid:K};return L;};var H=function(Q,M){var P=function(){return Q;};var O=function(){return M;};var L=function(R){if(Q==R.getNamespaceURI()){if(M){if(M==R.getModelVersion()){return true;}else{return false;}}return true;}else{return false;}};var K=function(S){var R=SpacesSDK.Utils.createXMLDocument("dummy").createElementNS(S,"dataModel");R.setAttribute("namespace",Q);if(M){R.setAttribute("version",M);}return R;};var N={getNamespace:P,getVersion:O,isDataObjectValid:L,getFilterAsXML:K};return N;};var I=function(P,O){(function(){if(!O){O=I.CompareType.STRICT;}})();var M=function(){return P;};var Q=function(){return O;};var L=function(T){var S=T.getNamespaceURI()?T.getNamespaceURI():"";switch(O){case I.CompareType.STRICT:if(S!=P){return false;}break;case I.CompareType.CONTAINS:if(S.indexOf(P)<0){return false;}break;case I.CompareType.REGEX:var R=S.match(P);if(!R||R[0]!=S){return false;}break;}return true;};var K=function(S){var R=SpacesSDK.Utils.createXMLDocument("dummy").createElementNS(S,"namespace");R.setAttribute("compareType",O);R.textContent=P;return R;};var N={getCompareString:M,getCompareType:Q,isDataObjectValid:L,getFilterAsXML:K};return N;};I.CompareType={STRICT:"strict",CONTAINS:"contains",REGEX:"regex"};var J=function(){var N=[];var M=function(P){if(!P.isDataObjectValid){throw"Invalid data object filter.";return;}N.push(P);};var O=function(){return N;};var K=function(Q){for(var P=0;P<N.length;P++){if(N[P].isDataObjectValid(Q)){return true;}}return false;};var L={addFilter:M,getFilters:O,isDataObjectValid:K};return L;};var G=function(Q,P){var N=function(){return Q;};var O=function(){return P;};var L=function(R){var U=R.getElement().getAttribute("timestamp");if(U){try{var S=f.getDateForISO8601(U);if(Q&&P){return(Q<=S&&S<=P);}else{if(Q){return(Q<=S);}else{if(P){return(S<=P);}}}}catch(T){console.warn("Failed to parse data object timestamp. Object filter is NOT applied.");return true;}}else{return false;}};var K=function(S){var R=SpacesSDK.Utils.createXMLDocument("dummy").createElementNS(S,"period");if(Q){R.setAttribute("from",SpacesSDK.Utils.getISO8601ForDate(Q));}if(P){R.setAttribute("to",SpacesSDK.Utils.getISO8601ForDate(P));}return R;};var M={getFrom:N,getTo:O,isDataObjectValid:L,getFilterAsXML:K};return M;};var E=function(O){var N=function(){return O;};var L=function(P){var Q=P.getElement().getAttribute("publisher");if(Q){return(Q.indexOf(O)==0);}else{return false;}};var K=function(Q){var P=SpacesSDK.Utils.createXMLDocument("dummy").createElementNS(Q,"publisher");P.textContent=O;return P;};var M={getPublisher:N,isDataObjectValid:L,getFilterAsXML:K};return M;};var D=function(N){var O=function(){return N;};var L=function(P){var Q=P.getElement().getAttribute("ref");if(Q){return(Q==N);}else{return false;}};var K=function(P){var Q=SpacesSDK.Utils.createXMLDocument("dummy").createElementNS(P,"references");Q.setAttribute("id",N);return Q;};var M={getReferenceId:O,isDataObjectValid:L,getFilterAsXML:K};return M;};return{AndFilter:F,DataModelFilter:H,NamespaceFilter:I,OrFilter:J,PeriodFilter:G,PublisherFilter:E,ReferencesFilter:D};})();var u=function(D){var M=D.ownerDocument;var N=null;(function(){if(!D){throw {name:"IllegalArgumentException",message:"The XML DOM must contain a root element."};}var R=D.getAttribute("cdmVersion");if(R&&SpacesSDK.cdm.CDMVersion.getVersionForString(R)!=null){N=new a(D);}else{N=null;}})();var K=function(){return N;};var O=function(){return D.getAttribute("cdmVersion");};var J=function(){var R=D.getAttribute("xsi:schemaLocation");if(R!=null){return new B(R.split(" ")[0],R.split(" ")[1]);}return null;};var F=function(){return D;};var G=function(){return D.tagName;};var I=function(){return D.getAttribute("id");};var L=function(){return D.getAttribute("modelVersion");};var Q=function(){return D.namespaceURI;};var P=function(){return D.namespaceURI.indexOf("mirror:application:")==0;};var H=function(){return f.generateXMLString(D);};var E={getCDMData:K,getCDMVersion:O,getDataModel:J,getElement:F,getElementName:G,getId:I,getModelVersion:L,getNamespaceURI:Q,isMIRRORDataObject:P,toString:H};return E;};var t=function(P,J){var H=null;(function(){if(!P){throw {name:"IllegalArgumentException",message:"Missing element name."};}H=f.createXMLDocument(P,J);})();var L=function(T,U,ad){var Q=H.childNodes[0];Q.setAttribute("xmlns:cdt","mirror:common:datatypes");var ac=H.createElement("creationInfo");if(T){var Z=T.getFullYear();var W=(T.getMonth()+1)<10?"0"+(T.getMonth()+1):(T.getMonth()+1);var aa=T.getDate();var R=T.getMilliseconds();R=R<10?"00"+R:(R<100?"0"+R:R);var S=T.toTimeString().match(/([0-9]{2}:[0-9]{2}:[0-9]{2}|[+-][0-9]{4})/g);S[1]=S[1].substr(0,3)+":"+S[1].substr(3,2);var Y=H.createElement("cdt:date");var X=H.createTextNode(Z+"-"+W+"-"+aa+"T"+S[0]+"."+R+S[1]);Y.appendChild(X);ac.appendChild(Y);}if(U){var V=H.createElement("cdt:person");V.appendChild(H.createTextNode(U));ac.appendChild(V);}if(ad){var ab=H.createElement("cdt:application");ab.appendChild(H.createTextNode(ad));ac.appendChild(ab);}Q.appendChild(ac);return D;};var K=function(T,U){var Q=H.childNodes[0];var S=H.createElement("attachment");if(U){S.setAttribute("type",U);}var R=H.createElementNS("mirror:common:datatypes","cdt:link");R.setAttribute("url",T);S.appendChild(R);Q.appendChild(S);};var G=function(R,V,T){var Q=H.childNodes[0];var S=H.createElement("attachment");if(T){S.setAttribute("type",T);}var U=H.createElementNS("mirror:common:datatypes","cdt:body");if(V){U.setAttribute("mimeType",V);}U.appendChild(H.createTextNode(R));S.appendChild(U);Q.appendChild(S);};var I=function(R,S,W,T){if(!R){throw {name:"IllegalArgumentException",message:"The tag name is required."};}var Q=H.childNodes[0];var U=H.createElement(R);if(S){for(var Y in S){U.setAttribute(Y,S[Y]);}}if(W){if(T){var X=f.generateXMLDocumentFromString(W);U.appendChild(X.childNodes[0]);}else{var V=H.createTextNode(W);U.appendChild(V);}}Q.appendChild(U);return D;};var E=function(R,S){if(!R||!S){throw {name:"IllegalArgumentException",message:"Attribute name and value are required."};}var Q=H.childNodes[0];Q.setAttribute(R,S);return D;};var M=function(){return new u(H.childNodes[0]);};var F=function(Q){Q.applyToElement(H.childNodes[0]);return D;};var O=function(R){var Q=H.childNodes[0];Q.setAttribute("modelVersion",R);return D;};var N=function(){return H.childNodes[0];};var D={addCDTAttachmentWithLink:K,addCDTAttachmentWithBody:G,addCDTCreationInfo:L,addNewElement:I,setAttribute:E,build:M,setCDMData:F,setModelVersion:O,getRootElement:N};return D;};var m=function(D,F){var E=new Object();E.name=D;E.handleDataObject=F;return E;};var d=function(ad,S,ac,E,G,D,Y,N,H){var Q={};(function(){if(G==o.ORGA&&E==null){E=[];}if(D==null){D=[];}if(Y==null){Y=[];}switch(G){case SpacesSDK.Type.PRIVATE:L();break;case SpacesSDK.Type.ORGA:K();case SpacesSDK.Type.TEAM:I();break;}})();function L(){var ae=function(){return Y[0].getJID();};Q.getOwner=ae;}function K(){var ae=function(){var af=[];for(var ag=0;ag<E.length;ag++){af[ag]=E[ag];}return af;};Q.getSupportedDataModels=ae;}function I(){var ae=function(){for(var af=0;af<D.length;af++){if(D[af].getType()==="muc"){return D[af];}}return null;};Q.getMUCChannel=ae;}var P=function(ae){if(ae.getId==null||typeof ae.getId!=="function"){return false;}else{if(ae.getType==null||typeof ae.getType!=="function"){return false;}else{if(G===ae.getType()&&S.toLowerCase()===space.getId().toLowerCase()){return true;}}}return false;};var M=function(){var ae=new l();ae.setName(ad);ae.setType(G);ae.setPersistenceType(N);ae.setPersistenceDuration(H);for(var af=0;af<Y.length;af++){var ag=new c(Y[af].getJID(),Y[af].getRole());ae.addMember(ag);}return ae;};var ab=function(){var ae=[];for(var af=0;af<D.length;af++){ae[af]=D[af];}return ae;};var Z=function(){return ac;};var R=function(){return S;};var F=function(){var ae=[];for(var af=0;af<Y.length;af++){ae[af]=Y[af];}return ae;};var U=function(){return ad;};var T=function(){for(var ae=0;ae<D.length;ae++){if(D[ae].getType()==="pubsub"){return D[ae];}}return null;};var W=function(){return G;};var V=function(af){for(var ae=0;ae<Y.length;ae++){if(Y[ae].getJID()===af){return true;}}return false;};var O=function(af){for(var ae=0;ae<Y.length;ae++){if(Y[ae].getJID()===af){if(Y[ae].getRole()===SpacesSDK.Role.MODERATOR){return true;}}}return false;};var X=function(){return N;};var J=function(){if(X()==SpacesSDK.PersistenceType.DURATION){return H;}else{return null;}};var aa=function(){for(var ae=0;ae<D.length;ae++){if(D[ae].getType()==="persistence"){return D[ae];}}return null;};Q.equals=P;Q.generateSpaceConfiguration=M;Q.getChannels=ab;Q.getDomain=Z;Q.getId=R;Q.getMembers=F;Q.getName=U;Q.getPubSubChannel=T;Q.getType=W;Q.isMember=V;Q.isModerator=O;Q.getPersistenceType=X;Q.getPersistenceDuration=J;Q.getPersistenceChannel=aa;return Q;};var e=function(F,E){var H=function(){return E;};var G=function(){return F;};var D={getProperties:H,getType:G};return D;};var l=function(F,U,S,K,H){(function(){if(S==null){S=[];}else{if(!S.length||S.length<0){var V=S;S=[];S.push(V);}}})();var P=function(V){T(V.getJID());S.push(V);};var D=function(){return S;};var N=function(){return U;};var Q=function(){return F;};var R=function(){return K;};var J=function(){if(R()==SpacesSDK.PersistenceType.DURATION){return H;}else{return null;}};var T=function(V){for(var X=0;X<S.length;X++){if(S[X].getJID()===V){for(var W=X;W<S.length-1;W++){S[W]=S[W+1];}S.length=S.length-1;break;}}};var O=function(V){S=V;};var I=function(V){U=V;};var E=function(V){K=V;};var G=function(V){H=V;};var L=function(V){F=V;};var M={addMember:P,getMembers:D,getName:N,getType:Q,getPersistenceType:R,getPersistenceDuration:J,removeMember:T,setMembers:O,setName:I,setPersistenceType:E,setType:L,setPersistenceDuration:G};return M;};var h=function(E){var N=null;var G=null;var J=null;(function(){N=E.getXMPPConnection();G=E.getCurrentUser();J=E.getConfiguration().requestTimeout();})();var I=function(V,Y,X,W){if(!X||!W){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}O.getSpace(Y,function(ab){var Z=ab.getMembers();for(var aa=0;aa<Z.length;aa++){if(Z[aa].getJID().toLowerCase()===V.split("/")[0].toLowerCase()){if(Z[aa].getRole()===SpacesSDK.Role.MODERATOR){X(true);return;}}}X(false);},W);};var R=function(V){if(!V.getName()||f.trimString(V.getName()).length==0){throw {name:"IllegalArgumentException",message:"Please specify a name which consists of at least one letter"};}else{if(!V.getType()||!o[V.getType()]){throw {name:"IllegalArgumentException",message:"Please specify a type which is in the enum Type."};}else{if(!V.getPersistenceType()||!s[V.getPersistenceType()]){throw {name:"IllegalArgumentException",message:"Invalid persistence type."};}else{for(var W=0;W<V.getMembers().length;W++){if(V.getMembers()[W].getRole()===i.MODERATOR){return;}}throw {name:"IllegalArgumentException",message:"Please specify at least one moderator"};}}}};var D=function(Y,aa,X){if(!aa||!X){throw {name:"IllegalArgumentException",message:"You have to specify two Callbacks."};}if(Y.getType().toLowerCase()!==SpacesSDK.Type.ORGA.toLowerCase()){throw {name:"IllegalArgumentException",message:"The given id doesn't belong to an Orgaspace."};}var Z="spaces."+N.domain;var V={xmlns:Strophe.NS.SPACES};var W=$iq({from:G.getFullJID(),to:Z,type:"get"}).c("spaces",V).c("models",{space:Y.getId()});N.sendIQ(W,function(af){var ab=af;var ac=new Array();models=ab.getElementsByTagName("model");for(var ae=0;ae<models.length;ae++){var ad=models[ae].attributes;if(ad.getNamedItem("namespace").value){ac.push(new B(ad.getNamedItem("namespace").value,ad.getNamedItem("schemaLocation").value));}else{ac.push(new B(ad.getNamedItem("namespace").nodeValue,ad.getNamedItem("schemaLocation").nodeValue));}}aa(ac);},X,J);};var O=new Object();var M=function(Y,V,X,W){if(!X||!W){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}R(V);I(G.getBareJID(),Y,function(ad){if(!ad){throw new SpacesSDK.SpaceManagementException("You have to be an moderator of an space to change its configuration.");}var af="spaces."+N.domain;var ab={xmlns:Strophe.NS.SPACES};var ae=$iq({from:G.getFullJID(),to:af,type:"set"}).c("spaces",ab).c("configure",{space:Y}).c("x",{xmlns:Strophe.NS.DATA,type:"submit"});ae.c("field",{"var":"FORM_TYPE",type:"hidden"}).c("value",null,Strophe.NS.SPACES+":config").up();ae.c("field",{"var":"spaces#type"}).c("value",null,o[V.getType()].toLowerCase()).up();var Z;switch(V.getPersistenceType()){case SpacesSDK.PersistenceType.ON:Z="true";break;case SpacesSDK.PersistenceType.OFF:Z="false";break;default:Z=V.getPersistenceDuration();}ae.c("field",{"var":"spaces#persistent"}).c("value",null,Z).up();ae.c("field",{"var":"spaces#name"}).c("value",null,V.getName()).up();ae.c("field",{"var":"spaces#members"});var aa=V.getMembers();for(var ac=0;ac<aa.length;ac++){var ag=aa[ac];ae.c("value",null,ag.getJID());}ae.up().c("field",{"var":"spaces#moderators"});for(var ac=0;ac<aa.length;ac++){var ag=aa[ac];if(ag.getRole()===SpacesSDK.Role.MODERATOR){ae.c("value",null,ag.getJID());}}N.sendIQ(ae,function(ah){O.getSpace(Y,X,W);},W,J);},W);};var K=function(Z,X){if(!Z||!X){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}var Y="spaces."+N.domain;var V={xmlns:Strophe.NS.SPACES};var W=$iq({from:G.getFullJID(),to:Y,type:"set"}).c("spaces",V).c("create",null);N.sendIQ(W,function(aa){O.getDefaultSpace(Z,X);},X,J);};var F=function(V,ac,aa){if(!ac||!aa){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}R(V);var ab="spaces."+N.domain;var ad={xmlns:Strophe.NS.SPACES};var ae=$iq({from:G.getFullJID(),to:ab,type:"set"}).c("spaces",ad).c("create",null).up().c("configure",null).c("x",{xmlns:Strophe.NS.DATA,type:"submit"});ae.c("field",{"var":"FORM_TYPE",type:"hidden"}).c("value",null,Strophe.NS.SPACES+":config").up();ae.c("field",{"var":"spaces#type"}).c("value",null,o[V.getType()].toLowerCase()).up();var W;switch(V.getPersistenceType()){case SpacesSDK.PersistenceType.ON:W="true";break;case SpacesSDK.PersistenceType.OFF:W="false";break;default:W=V.getPersistenceDuration();}ae.c("field",{"var":"spaces#persistent"}).c("value",null,W).up();ae.c("field",{"var":"spaces#name"}).c("value",null,V.getName()).up();ae.c("field",{"var":"spaces#members"});var X=V.getMembers();for(var Z=0;Z<X.length;Z++){var Y=X[Z];ae.c("value",null,Y.getJID());}ae.up().c("field",{"var":"spaces#moderators"});for(var Z=0;Z<X.length;Z++){var Y=X[Z];if(Y.getRole()===SpacesSDK.Role.MODERATOR){ae.c("value",null,Y.getJID());}}N.sendIQ(ae,function(ag){var af=ag;O.getSpace(af.getElementsByTagName("create")[0].attributes.space.nodeValue,ac,aa);},aa,J);};var L=function(X,W,V){if(!W){W=function(){console.log("Successfully deleted space.");};}if(!V){V=function(Y){console.warn("Failed to delete space:",Y);};}I(G.getBareJID(),X,function(aa){if(!aa){V("You are not allowed to delete this space.");return;}var ab="spaces."+N.domain;var Z={xmlns:Strophe.NS.SPACES};var Y=$iq({from:G.getFullJID(),to:ab,type:"set"}).c("spaces",Z).c("delete",{space:X});N.sendIQ(Y,function(ac){W();},function(ac){V(ac);});},function(Y){V(Y);});};var P=function(W,X,V){if(!X||!V){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}N.spaces.getSpaceDetails(W.id,function(Y){var Z=Y;N.spaces.getSpaceChannels(W.id,function(an){var ah=an;var ae=[];var ac=[];var am=SpacesSDK.Type.getTypeForString(Z.type);var ab=[];for(var ag=0;ag<Z.members.length;ag++){var af=SpacesSDK.Role.MEMBER;for(var ad=0;ad<Z.moderators.length;ad++){if(Z.moderators[ad]===Z.members[ag]){af=SpacesSDK.Role.MODERATOR;}}ae.push(new c(Z.members[ag],af));}for(var ak in ah){var aj={};for(var al in ah[ak]){aj[al]=ah[ak][al];}ac.push(new e(ak,aj));}var aa;var ai;switch(typeof Z.persistent){case"boolean":aa=Z.persistent?SpacesSDK.PersistenceType.ON:SpacesSDK.PersistenceType.OFF;ai=null;break;case"string":aa=SpacesSDK.PersistenceType.DURATION;ai=Z.persistent;break;}if(am===SpacesSDK.Type.ORGA){D(new d(W.name,W.id,W.domain,ab,am,ac,ae,aa,ai),function(ao){X(new d(W.name,W.id,W.domain,ao,am,ac,ae,aa,ai));},V);}else{X(new d(W.name,W.id,W.domain,ab,am,ac,ae,aa,ai));}},V,J);},V,J);};var S=function(W,V){if(!W||!V){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}N.spaces.getSpacesList(function(ab){var Z=ab;var X=[];var ad=new Object();var ae=function(ag){if(!ad[ag.getId()]){ad[ag.getId()]=true;X.push(ag);for(var af=0;af<Z.length;af++){if(!ad[Z[af].id]){return;}}W(X);}};for(var aa=0;aa<Z.length;aa++){var ac=aa;var Y=function(ag){if(!ad[Z[ac].Id]){ad[Z[ac].id]=true;for(var af=0;af<Z.length;af++){if(!ad[Z[af].id]){return;}}W(X);}};P(Z[aa],ae,Y);}},V,J);};var U=function(W,V){O.getSpace(G.getUsername(),W,V);};var H=function(X,W,V){if(!W||!V){throw {name:"IllegalArgumentException",message:"You have to specify two Callbacks."};}N.spaces.getSpacesList(function(Y){var Z=Y;var ab=null;for(var aa=0;aa<Z.length;aa++){if(Z[aa].id!==X){continue;}ab=Z[aa];}if(ab!=null){P(ab,W,V);}else{W(null);}},V,J);};var Q=function(X,W){if(!X||!W){throw {name:"IllegalArgumentException",message:"You have to specify two Callbacks."};}var V=function(Y){var Z=Y;var Y={};if(Z!=null){for(var aa=0;aa<Z.length;aa++){Y[Z[aa].id]=Z[aa].name;}}X(Y);};N.spaces.getSpacesList(V,W,J);};var T=function(Y,V,X,W){if(!X||!W){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}I(G.getBareJID(),Y,function(Z){if(!Z){throw new SpacesSDK.SpaceManagementException("You have to be an moderator of an space to delete it.");}O.getSpace(Y,function(ad){if(ad==null){throw new SpacesSDK.UnknownEntityException("A space with such an id couldn't be found.");}else{if(ad.getType().toLowerCase()!==SpacesSDK.Type.ORGA.toLowerCase()){throw {name:"IllegalArgumentException.",message:"The given id doesn't belong to an Orgaspace."};}}var ae="spaces."+N.domain;var aa={xmlns:Strophe.NS.SPACES};var ac=$iq({from:G.getFullJID(),to:ae,type:"set"}).c("spaces",aa).c("models",{space:Y});for(var ab=0;ab<V.length;ab++){ac.c("model",{namespace:V[ab].getNamespace(),schemaLocation:V[ab].getSchemaLocation()}).up();}N.sendIQ(ac,function(af){X(new d(ad.getName(),Y,ad.getDomain(),V,ad.getType(),ad.getChannels(),ad.getMembers(),ad.getPersistenceType(),ad.getPersistenceDuration()));},W,J);},W);},W);};var O={configureSpace:M,createDefaultSpace:K,createSpace:F,deleteSpace:L,getAllSpaces:S,getDefaultSpace:U,getSpace:H,getSpacesList:Q,setModelsSupportedBySpace:T};return O;};var c=function(G,I){(function(){if(!G.match(/@/)){throw {name:"IllegalArgumentException",message:"There has to be a domain as part of the jid."};}if(G.match(/\//)){G=G.split("/")[0];}})();var H=function(J){if(J.getJID==null||typeof J.getJID!=="function"){return false;}else{if(J.getRole==null||typeof J.getRole!=="function"){return false;}else{if(J.getJID()===G&&J.getRole===I){return true;}}}return false;};var F=function(){return G;};var E=function(){return I;};var D={equals:H,getJID:F,getRole:E};return D;};var k=function(I,H,F){var E=function(){var M=[];M.push(I,"@",H);return M.join("");};var L=function(){return H;};var G=function(){var M=[];M.push(I,"@",H,"/",F);return M.join("");};var J=function(){return F;};var K=function(){return I;};var D={getBareJID:E,getDomain:L,getFullJID:G,getResource:J,getUsername:K};return D;};var A={VERSION:y,Utils:f,cdm:q,ConnectionStatus:n,Role:i,Type:o,PersistenceType:s,SpaceManagementException:j,UnknownEntityException:r,CDMData:a,CDMDataBuilder:x,ConnectionConfiguration:w,ConnectionConfigurationBuilder:b,ConnectionHandler:g,ConnectionStatusListener:v,NetworkInformation:z,DataHandler:C,DataModel:B,DataObject:u,DataObjectBuilder:t,DataObjectListener:m,Space:d,SpaceChannel:e,SpaceConfiguration:l,SpaceHandler:h,SpaceMember:c,UserInfo:k,filter:p};return A;})();